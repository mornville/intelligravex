{% extends "base.html" %}
{% block content %}
  <div class="row">
    <h1 style="margin: 0;">Conversations{% if bot %} — {{ bot.name }}{% endif %}</h1>
    <span class="pill">total: {{ total if total is not none else (conversations|length) }}</span>
    <div class="right"></div>
    {% if bot %}
      <a class="pill" href="/bots/{{ bot.id }}">Back to bot</a>
    {% endif %}
  </div>

  <div class="card" style="margin-top: 14px;">
    <div class="row" style="gap: 10px;">
      <span class="muted">Page {{ page or 1 }} • {{ page_size or (conversations|length) }} / page</span>
      <div class="right"></div>
      {% set prev_page = (page or 1) - 1 %}
      {% set next_page = (page or 1) + 1 %}
      {% if prev_page >= 1 %}
        {% if bot %}
          <a class="pill" href="/bots/{{ bot.id }}/conversations?page={{ prev_page }}&page_size={{ page_size }}">Prev</a>
        {% else %}
          <a class="pill" href="/conversations?page={{ prev_page }}&page_size={{ page_size }}">Prev</a>
        {% endif %}
      {% endif %}
      {% if total is not none and (page or 1) * (page_size or 50) < total %}
        {% if bot %}
          <a class="pill" href="/bots/{{ bot.id }}/conversations?page={{ next_page }}&page_size={{ page_size }}">Next</a>
        {% else %}
          <a class="pill" href="/conversations?page={{ next_page }}&page_size={{ page_size }}">Next</a>
        {% endif %}
      {% endif %}
    </div>

    <div style="overflow:auto; margin-top: 12px;">
      <table style="width:100%; border-collapse: collapse; min-width: 860px;">
        <thead>
          <tr>
            <th style="text-align:left; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">Created</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">UUID</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">Bot</th>
            <th style="text-align:left; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">Test</th>
            <th style="text-align:right; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">Cost (est)</th>
            <th style="text-align:right; padding:10px; border-bottom:1px solid rgba(120,150,220,0.18);">Last total</th>
          </tr>
        </thead>
        <tbody>
          {% for c in conversations %}
            <tr>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10);" class="muted">{{ c.created_at }}</td>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10);">
                <a href="/conversations/{{ c.id }}"><code>{{ c.id }}</code></a>
              </td>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10);">
                <span class="pill">{{ bots_by_id.get(c.bot_id).name if bots_by_id.get(c.bot_id) else c.bot_id }}</span>
              </td>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10);">
                {% if c.test_flag %}<span class="pill">test</span>{% else %}<span class="muted">—</span>{% endif %}
              </td>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10); text-align:right;">
                <span class="pill">${{ "%.6f"|format(c.cost_usd_est or 0.0) }}</span>
              </td>
              <td style="padding:10px; border-bottom:1px solid rgba(120,150,220,0.10); text-align:right;">
                <span class="pill">{% if c.last_total_ms is not none %}{{ c.last_total_ms }}ms{% else %}—{% endif %}</span>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if not conversations %}
    <div class="card" style="margin-top: 14px;">
      <div class="muted">No conversations yet.</div>
    </div>
  {% endif %}
{% endblock %}
